---
title: VS Code，打造沉浸式 Hexo 写作环境
date: 2018-03-13 21:58:54
updated:
categories:
- 实用工具
- Hexo
tags:
- Hexo
- Visual Studio Code
- Markdown
keywords: Hexo, Visual Studio Code, Markdown
---
在 {% post_link hexo-your-blog 《Hexo 你的专属博客》%} 一文中，你了解到了如何搭建 Hexo 博客站点并部署到远程仓库，实现了博文源码及站点配置的备份，并且还探讨了如何在多个设备上同步博客站点。

……假定已读前文，并且已创建了你的blog站点……为方便解说，针对默认的landscape主题。

本文主要包括两方面的内容，首先是了解 Hexo 中与写作的相关事项和概念，其次是介绍如何利用 Visual Studio Code来打造一个专注无干扰的 Markdown 写作环境。读完本文，你就可以做到心无挂碍、高效流畅地撰写你的博文了。
<!--more-->

## Hexo 的常规写作方式

现在，先来了解一下 Hexo 的常规写作方式，顺便了解在 Hexo 中非常重要的布局和模板的概念。

按 [Hexo 官方文档](https://hexo.io/zh-cn/docs/writing.html) 的说明，创建新博文的命令如下：

```bash
$ hexo new [layout] <title>
```

运行这个命令，即可为新博文创建一个 Markdown（.md）文件。并且，若此时启动 Hexo 本地服务器，也可看到博文已经添加到站点中了。这个命令有两个选项：

* `layout`：为新博文指定布局，未指定时默认采用 post 布局。其余两个布局选项分别是 draft 和 page。
* `title`：指定新博文的文件名，同时也是新博文在页面上最初显示的标题。若指定的标题中包含空格，则必须包围在一对半角双引号中（建议总是加上双引号，省心）。标题也可以是中文，不过英文的文件名兼容性更好。此外，Hexo 会自动将文件名中的下划线（_）自动更改为连字符（-）。

### 关于 Hexo 的布局

所谓的 ** 布局（layout）**，就是博文最终呈现出来的外观排版。如下图所示，你在每篇博文中输入的内容，将被 “嵌入” 到最终页面的 “正文” 位置。而正文之外的其它内容，如页眉、页脚及边栏等，则由 Hexo 根据你指定的布局及站点主题自动生成。

![Hexo 布局](../imgs/hexo_layout.png)

某种布局最终呈现出来的版面外观效果，由当前主题的 layout 文件夹中的同名. ejs 文件定义。在生成最终的静态页面时，Hexo 会自动把每一篇博文 “嵌入” 到相应的. ejs 布局中——\_posts 中的博文嵌入 post.ejs 布局，\_drafts 中的博文嵌入 draft.ejs 布局，而 page 博文则采用了 page.ejs 布局。

当然，最终的版面效果取决于你使用的主题。不同的主题定义了不同内容的. ejs 文件集，而你的博文，总是 “一如既往” 地嵌入到相应的布局中的某个位置。这，也是你能够随心所欲地切换站点主题的原因。

作为测试，运行 `hexo n "test"` 命令创建一篇博文，观察 Hexo 自动在 “source\\_post” 文件夹中生成名为 “test.md” 的文件。启动 Hexo 服务器并在浏览器中查看本地站点和博文，观察并体会博文与其它布局元素之间的关系。

### 关于 Hexo 的模板

在你的编辑器中打开刚刚生成的 test.md 文件，可发现文件中已包含如下内容：

```yml
---
title: test
date: 2018-03-07 14:45:03
tags:
---
```

两个 `---` 及它们之间的内容，就是所谓的 **front matter**，用于保存关于博文的元数据。除博文标题及创建时间外，还可以在这里指定博文的标签、类别、关键字等等。完整的 front matter 参数及用途，请参阅 [Hexo 文档](https://hexo.io/zh-cn/docs/front-matter.html)。

这些front matter源自于Hexo的模板。在创建博文时，Hexo 将自动根据你指定的 `layout`，自动对博文应用 scaffolds 文件夹中的相应模板。由于刚才创建博文时采用了默认的 post 布局，因此 Hexo 将自动套用 scaffolds\\post.md 模板来生成 test.md。

在编辑器中打开 scaffolds\\post.md 模板，可发现其中包含与 test.md 中对应的 front matter。当然，双花括号之间的 `title` 和 `date`，已被自动替换为刚刚创建的博文的标题和创建时间：

```yaml
---
title: {{title}}
date: {{date}}
tags:
---
```

Hexo 的默认模板比较简陋，你可以根据实际需要在模板中增加常用的元数据，如更新时间、类别及关键字等，以便在今后创建博文时，自动生成更完整的 front matter。例如：

```yaml
---
title: {{title}}
date: {{date}}
updated: {{date}}
tags:
categories:
keywords:
---
```

回到 test.md，把 front matter 中双花括号中的 `title` 修改为 `博文测试`，并在后一个 `---` 之后随便输入一些内容作为博文的正文。告一段落后，在浏览器中刷新博客站点，可发现新博文的标题和内容也随着更新了。可见，Hexo 能够自动监视博文内容的改变，并且也不必重启服务器。

> **提示**：博文的页面标题不必总是与文件名保持一致。随着你撰写越来越多的博文，你会发现现实中往往如此。即使是 Hexo 默认提供的“Hello World”博文，其文件名也是不一致的“hello-world.md”。

### 关于标签和类别

当你的博文数量越来越多的时候，你或你的读者要怎样才能快速找到想要阅读的博文呢？Hexo 通过标签和类别提供了两种归类和检索博文的方式。

标签通常是从博文内容提炼的一个或多个关键词。你可以在 front matter 的 `tags:` 节点中，按如下方式为每一篇博文指定一个或多个标签：

```yaml
# 若只有单个标签，则在同一行中指定（注意冒号后有一个空格）
tags: hexo
# 若需要多个标签，则以多行方式指定
tags:
- hexo
- git
```

指定标签后，刷新站点页面，即可在侧边栏看到 “标签” 栏目。单击该栏目中的某个标签，将列出所有含有该标签的博文的链接；单击任一链接，即可打开并阅读相应的博文。

除标签外，你还可以从另一维度给你的博文分类。在 front matter 中增加 `categories:` 节点，并指定博文所属的一个或多个类别。同样，刷新站点可马上看到 “分类” 栏目：

```yaml
# 若只有单个类别，则在同一行中指定（注意冒号后有一个空格）
categories:
# 若需要多个类别，则以多行方式指定
categories:
- 实用工具
- Hexo
```

需要注意的是，与多个标签并无主次之分不同，多个类别间具有层级关系。首先列出的类别为一级类别，后续列出的类别依次为其前面类别之下的子类别。以上面的多类别设置为例，页面上将把 “Hexo” 类别缩进显示在 “实用工具” 类别之下，表示 “Hexo” 是“实用工具”中的一个子类别。

> **提示**：不同的主题，可能采用不同的方式来呈现类别，例如，Hueman 主题将以菜单的形式来显示类别。

### 关于draft和page

前面提到，创建新博文时，还可以选择draft和page布局。难道，除了写博文之外，你还需要写别的什么吗？

是的。你还可以使用draft布局来创建草稿或不想公开发表的博文，而page布局则可为你的博客站点增加功能性的页面。

实际上，新建博文命令的`layout`参数也决定了新生成的博文的存放位置。采用 post 布局的博文文件将自动存放到 source\\_posts 文件夹中，draft 博文存入 source\\_drafts 文件夹，page 页面则直接放在 source 文件夹中。

假设你突然产生了一个想法，但还不够成熟，也暂时没时间将其写成正式的博文，那么，你可以用`hexo n draft "my-idea"`来创建一篇草稿，并在其中快速且粗略地记下这个想法；当然，你也可以利用这个草稿来收集相关的资料。

> **提示**：如果你跟我一样，希望每次新建博文都从草稿开始，则可在站点配置文件中，把`default_layout`设置为`draft`。这样运行`hexo n "<filename>"`命令就将直接创建草稿，而不是正式的博文。

默认时Hexo不会在站点中显示草稿，也不会在远程仓库中公开发布（放心，只是没有公开发布到master分支而已，草稿的源码依然会备份到src分支）。在逐步润饰完善草稿的过程中，你可以利用vscode来预览草稿；如果希望查看草稿的整体效果，只需在启动Hexo服务器时加上`--drafts`参数，如`hexo s --drafts`，即可让本地站点显示出所有的草稿。

最后，当你打算把草稿发布为正式的博文时，运行`hexo publish "<filename>"`命令来把把指定的草稿从source\\_drafts中转移到source\\_posts中，并自动填写发布时间。从这时候起，这篇草稿就会像普通的博文一样公开发布了。

> **警告**：不要把站点配置中的`render_drafts`设置为`true`，这将导致所有草稿也被公开发布，除非你想公开尚未完成的或隐私的博文。

至于使用page布局来生成功能性页面方面，给站点添加“关于我”的页面，就是一个很好的例子。运行如下命令来创建自我介绍的页面：

```bash
hexo n page "about"
```

Hexo自动在source文件夹中生成about\\index.md文件。在编辑器中打开该文件，并输入你的简介，完成后保存。然后，打开主题配置文件（themes\\<theme-name\>\\_config.yml），并在`menu`中添加`About: /about`菜单。如下：

```yml
menu:
  Home: /
  Archives: /archives
  About: /about
```

现在，你已经掌握了 Hexo 中与博文相关的基本概念了。遵循简洁轻便低入侵性的 Markdown 语法，你可以开始 “专注无干扰” 地撰写你的博文了。

> **提示**：Markdown 是一种轻量级的纯文本标记语言，只需输入少量标记，即可生成格式优美的印刷级排版。如果你还不了解 Markdown，可参考 [Markdown快速入门](http://wowubuntu.com/markdown/basic.html)。

## 用 Visual Studio Code 撰写博文

专注无干扰？没错，Markdown语法本身的确简洁流畅，但在创建、编辑和预览博文的过程中，既要运行Git Bash并输入命令，又要在文本编辑器中一层层寻找并打开文件，还是会让写作思路时不时中断的。

说得好！你已经想到了，但你还不知道你需要使用**Visual Studio Code**。

Visual Studio Code（后称vscode）是微软出品的一个跨平台、轻量级且功能强大的代码编辑器，原生支持JavaScript、TypeScript及Node.js，并且可通过扩展（即插件）来支持C++、C#、Java及Python等几乎所有语言，当然也包括你在Hexo中撰写博文所使用的Markdown语言。vscode一经推出即好评如潮，是文本或代码编辑器的不二之选。

> **提示**：访问[vscode官方站点](https://code.visualstudio.com/)来获取更多相关信息。

近年来，各种各样的Markdown编辑器层出不穷，在线的离线的都有。在我们的情形中，vscode之所以能够脱颖而出，是因为vscode在界面中集成了一个终端，默认配置为使用Windows PowerShell。在这个集成终端中，你可以输入并执行任何命令，无论是你已渐渐熟悉的`hexo`命令、还是`git`命令，以及Node.js的`npm`命令，都可以信手拈来。

> **提示**：如果你希望使用其它终端（比如Git Bash），则可在vscode中按下F1键打开“命令面板”，输入`Select Default Shell`后回车，然后从清单中选择Git Bash即可。

有了这个多才多艺的vscode，你就可以进入真正“专注无干扰”地撰写博文的禅境了。

### 进入写作禅境

启动vscode，选择**文件 | 打开文件夹**打开你的博客站点文件夹。

按下**Ctrl+\`** 激活vscode下方的集成终端面板，在这个终端中输入`hexo n "myblog"`并回车。片刻之后，source\\\_posts中就生成了myblog.md文件。

> **提示**：你应该已经了解到，几乎所有的Hexo命令都有对应的简化版本，例如`hexo n`相当于`hexo new`、`hexo s`相当于`hexo server`等等。关于完整的Hexo命令清单，请参阅[Hexo文档](https://hexo.io/zh-cn/docs/commands.html)。

按下**Ctrl+P**激活vscode的“快速打开”面板，并输入刚刚创建的文件名`myblog`，从弹出的清单中选择“myblog.md source\\\_posts”并回车，vscode随即在编辑器窗口中打开这个文件。

接下来，想必你已经知道了，不外乎就是像平常一样修改front matter，遵循Markdown规则来撰写你的博文了。

如果想预览博文，可按下**Ctrl+K, V**打开vscode自带的Markdown预览窗口。当然了，你在这里看到的，只是博文本身内容的预览。

如果想预览整体效果，可激活终端并执行`hexo s -o`，启动Hexo本地服务器并自动在默认浏览器中打开博客站点（这是`-o`选项的效果）。

启动Hexo服务器后，当前的终端就被占用了。如果需要执行其它命令，同时又不想按下**Ctrl+C**来关闭Hexo服务器，则可按下**Ctrl+Shift+\`** 来打开一个新的集成终端（终端面板右上角的下拉列表，可用来在不同的终端间切换）。

你可能已经注意到了，到现在为止，你的手还没有离开过键盘！

在vscode中，一切都在你的指尖。大多数情况下，你都不用中止输入，不必腾出手来抓住鼠标到处寻找和点击——这不但影响了你的效率，也干扰了你的思路。

如果你足够细心的话，你会发现vscode侧边栏的“源代码管理”图标上，叠加了一个带有数字的圆点。这意味着vscode内置的Git检测到了当前站点与远程仓库之间存在未同步的内容。不过，远程仓库的管理和站点的部署，仍然必须使用Hexo的deploy命令。因为，在部署到远程仓库之前，Hexo还执行了大量的操作，包括博文内容与布局的合成，以及生成最终的静态HTML文件等。

当你完成了新博文的编辑，或者是修改了站点的配置之后，就可以执行一次清理，并通过部署来发表博文和备份站点。依然是激活集成终端，然后输入并执行如下命令——你还是不用离开键盘：

```bash
$ hexo clean
INFO  Deleted database.
...
$ hexo d -g
INFO  Start processing
...
```

至此，你已渐渐进入撰写博文的禅境。一切纷扰离你而去，万籁俱寂之中，你正全神贯注、心无旁骛地让你的思想和见解，静静地经由你的指尖流淌出来……

### 继续扫清障碍

你已经能够专注无干扰地撰写博文了。不过，前行的路上，多少还有一些小障碍需要克服。在Markdown方面，vscode扩展市场中存在若干插件，适当的利用可进一步提高你的写作效率和质量。

#### markdownlint

是一个Markdown语法检查器。博文中不符合Markdown规范的内容将被标上波浪线，并提供相应的改进提示。这个扩展可确保你的博文具有更高的兼容性（可由Hexo之外的其它Markdown解析器顺利读取），同时也可帮助你形成规范的语法习惯。

> **提示**：按下**Ctrl+Shift+X**在侧边栏打开“扩展”面板，输入扩展名称即可自动执行搜索，找到所需扩展后，单击其右下角的“安装”按钮并耐心等待。安装完成后出现“重新加载”按钮，单击即可让新安装的扩展马上生效。

#### Markdown Shortcuts

顾名思义，这个扩展为vscode提供了一组插入Markdown标记的快捷键。尽管Markdown与HTML相比已非常简洁，但插入链接（`[a hyperlink](www.example.org)`）或图像（`![alt text](image_url.png)`）的标记仍然颇为复杂，尤其是在使用中文输入法时，时常会因忘记切换全角半角标点符号而反复犯错，极大地影响了输入的流畅性。安装此扩展后，只需：

* 按下**Ctrl+L**，然后依提示分别填入链接文本（若未选定文本的话）和目标URL（最好事先复制好链接）。
* 按下**Ctrl+Shift+L**，然后依提示分别填入替代文本及图片的URL。
* 更多的快捷键，详见该扩展主页上的“详细信息”。

> **提示**：如果你使用Chrome浏览器的话，则可考虑使用名为[copy-as-markdown](https://github.com/chitsaou/copy-as-markdown/)的浏览器扩展，来直接从浏览器上获取Markdown格式的链接。

Hexo在图像路径解析方面似乎存在问题，一种比较简明的解决方法是：把所有图片放入source\\imgs文件夹中，在站点配置文件中设置`permalink: :title/`，同时在博文中以`../imgs/example.png`的形式引用图像。这样预览和发布的博文均可正确显示图像。

#### vscode-pangu

这是一个非常简单的插件，用于在中文和英文之间插入一个空格，让最终的排版结果更美观（配置中有auto_spacing，好用吗？需要`$ npm install hexo-filter-auto-spacing --save`）。经常会出错，例如加粗的中文`**中文**`会变成`** 中文 **`，失去加粗效果……所以还是用pangu更稳妥。
全部加空格后，再利用查找替换一次性把`** `及` **`替换为`**`。

#### Markdown Preview Enhanced

改善了vscode的Markdown预览，可显示博文目录，并支持输出HTML、PDF、eBook等格式。

#### Hexo tag snippets

除标准的Markdown标记外，博文中也可以使用Hexo的[自定义标记](https://hexo.io/zh-cn/docs/tag-plugins.html)，例如（{% post_link slug [title] %}）可用于插入站内博文链接。不过，要注意这些标签只有在Hexo才能正确解析，一旦迁移到其它解析器可能会失效（实际上，vscode的预览就已无法解析这些标记），因此应尽量慎用。

如果确实需要使用Hexo标记的话，你可以安装名为**Hexo tag snippets**的vscode扩展。该扩展把Hexo标记定义为代码片段，只需简短的输入可快速输入这些标记。
（需要改配置：    "[markdown]": {
        "editor.wordWrap": "on",
        "editor.quickSuggestions": true
    },
）

如果想自己定义代码片段……比如Hexo tag snippets缺失的站内博文链接的snippet……，顺便定义一下摘要`<!-- readmore -->`

> 不习惯的话，影响写作的话，只能关闭。

vscode的扩展，或许是除集成终端外，又一个让它完胜其它Markdown编辑器的特性。扩展的可能性是无穷的……随着时间的推移越来越好用……新扩展出现……

## 尾声

……换一下主题……
有机会写一写具体主题的东东……